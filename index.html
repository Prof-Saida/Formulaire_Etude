<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Redirection alternée — FormA / FormB</title>
<style>
body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;margin:0;padding:1.25rem;display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f7f7fb;color:#111}
.card{max-width:560px;width:100%;background:#fff;padding:1.25rem;border-radius:12px;box-shadow:0 6px 18px rgba(20,20,40,0.08);text-align:center}
.small{color:#555;font-size:.95rem}
.btn{display:inline-block;margin-top:1rem;padding:.6rem 1rem;border-radius:8px;border:0;background:#0b69ff;color:#fff;text-decoration:none;font-weight:600}
.muted{color:#777;font-size:.9rem;margin-top:.75rem}
</style>
</head>
<body>
<div class="card" role="region" aria-live="polite">
<h1 id="title">Redirection en cours…</h1>
<p class="small" id="message">Nous déterminons quelle version du formulaire ouvrir (A ou B). Ceci fonctionne sur ordinateur et téléphone.</p>
<div id="info" class="muted">Si la redirection automatique échoue, utilisez le bouton ci-dessous.</div>
<a id="fallback" class="btn" href="#" style="display:none">Aller au formulaire</a>
</div>


<script>
// === CONFIG ===
// Replace with your deployed Google Apps Script Web App URL (the one that returns JSON)
const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzTpS_FytN4noQx_I5HtqbpSWL6OgYmE_zNV5Un0QF5Knb7bm6yVJJcEp70kItqX0cjnA/exec';
// Optional timeout in ms before showing fallback
const FALLBACK_TIMEOUT = 4000;


// === END CONFIG ===


const title = document.getElementById('title');
const message = document.getElementById('message');
const info = document.getElementById('info');
const fallback = document.getElementById('fallback');


let fallbackTimer = setTimeout(() => {
info.textContent = 'La redirection prend trop de temps. Cliquez sur le bouton ci-dessous.';
fallback.style.display = 'inline-block';
}, FALLBACK_TIMEOUT);


async function getNextForm() {
try {
const resp = await fetch(GAS_WEB_APP_URL, { method: 'POST', mode: 'cors' });
if (!resp.ok) throw new Error('Réponse du serveur non OK');
const data = await resp.json();


// expected format: { form: 'A'|'B', url: 'https://...' }
if (!data || !data.form || !data.url) throw new Error('Format de réponse invalide');


clearTimeout(fallbackTimer);
title.textContent = 'Redirection vers Formulaire ' + data.form;
message.textContent = 'Vous allez être redirigé vers le formulaire. Si la redirection automatique est bloquée, utilisez le bouton ci-dessous.';
fallback.href = data.url;
fallback.textContent = 'Ouvrir Formulaire ' + data.form;


// attempt automatic redirect (works in most browsers)
window.location.replace(data.url);


} catch (err) {
console.error(err);
</html>
